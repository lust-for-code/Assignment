<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/tab1.css">

</head>

<body>
    <br><br><br>
    <p id="logout"><a href="/logout">Logout</a></p>
    <p id="welcome">Welcome
        <%=currUser.email%>
    </p>
    <div class="tab">
        <button class="tablinks" onclick="openCity('create', 'search',1)" id="cr1">Create Code</button>
        <button class="tablinks" onclick="openCity('search', 'create',2)" id="cr2">Search Code</button>
    </div>

    <br>

    <div id="create">
        <div id="popup">
            <button type="button" class="btn btn-default btn-sm" id="plus" onclick="disp()">
		<span class="glyphicon glyphicon-plus-sign"></span>
	  </button>
            <h4 id="plus1">Create Code</h4><br><br>

            <div id="popup1">
                <div class="info">
                    <form action="/code" method="POST">
                        <select name="state" id="state" class="form-control">
		<option value="State" style="display: none;">State</option>
		<option value="Andhra Pradesh">Andhra Pradesh</option>
		<option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
		<option value="Arunachal Pradesh">Arunachal Pradesh</option>
		<option value="Assam">Assam</option>
		<option value="Bihar">Bihar</option>
		<option value="Chandigarh">Chandigarh</option>
		<option value="Chhattisgarh">Chhattisgarh</option>
		<option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
		<option value="Daman and Diu">Daman and Diu</option>
		<option value="Delhi">Delhi</option>
		<option value="Lakshadweep">Lakshadweep</option>
		<option value="Puducherry">Puducherry</option>
		<option value="Goa">Goa</option>
		<option value="Gujarat">Gujarat</option>
		<option value="Haryana">Haryana</option>
		<option value="Himachal Pradesh">Himachal Pradesh</option>
		<option value="Jammu and Kashmir">Jammu and Kashmir</option>
		<option value="Jharkhand">Jharkhand</option>
		<option value="Karnataka">Karnataka</option>
		<option value="Kerala">Kerala</option>
		<option value="Madhya Pradesh">Madhya Pradesh</option>
		<option value="Maharashtra">Maharashtra</option>
		<option value="Manipur">Manipur</option>
		<option value="Meghalaya">Meghalaya</option>
		<option value="Mizoram">Mizoram</option>
		<option value="Nagaland">Nagaland</option>
		<option value="Odisha">Odisha</option>
		<option value="Punjab">Punjab</option>
		<option value="Rajasthan">Rajasthan</option>
		<option value="Sikkim">Sikkim</option>
		<option value="Tamil Nadu">Tamil Nadu</option>
		<option value="Telangana">Telangana</option>
		<option value="Tripura">Tripura</option>
		<option value="Uttar Pradesh">Uttar Pradesh</option>
		<option value="Uttarakhand">Uttarakhand</option>
		<option value="West Bengal">West Bengal</option>
		</select><br>
                        <select name="atype" id="atype" class="form-control">
			<option value="type" style="display: none;">A Type(C/S)*</option>
			<option value="C">C</option>
			<option value="S">S</option>
		</select><br>
                        <input type="text" name="ref" placeholder="Ref. No." id="ref">
                        <p id="incode">
                            <%=inCode%>
                        </p>
                        <br><br>
                        <select name="dtype" id="dtype" class="form-control" oninput="gen3()">
			<option value="type" style="display: none;">D Type(G/P/U)*</option>
			<option value="G">G</option>
			<option value="P">P</option>
			<option value="U">U</option>
		</select>

                        <br>
                        <input type="submit" value="Create Code" id="create_code"> &nbsp;&nbsp;&nbsp;&nbsp;
                        <button id="cancel" onclick="nodisp()">Cancel</button>
                        <br>
                        <p id="generetedCode" style="display: none;">
                            <%=inCode%>

                        </p>
                    </form>

                </div>
            </div>
        </div>
    </div>





    <br><br><br><br>
    <div id="search">
        <form>
            <input type="date" name="startDate" id="startDate">
            <input type="date" name="endDate">
            <button type="submit">Submit</button>
        </form>
        <p id="logout"><a href="/csv">Export to CSV</a> </p>
        <!-- <div id="popup"> -->
        <div id="Table">
            <table id="myTable">
                <thead>
                    <th>
                        <div class="inner-addon left-addon">
                            <i class="glyphicon glyphicon-search"></i>
                            <input type="text" id="myInput1" class="form-control" placeholder="State" onkeyup="fx1('myInput1',0)" />
                        </div>
                    </th>
                    <th>
                        <div class="inner-addon left-addon">
                            <i class="glyphicon glyphicon-search"></i>
                            <input type="text" id="myInput2" class="form-control" placeholder="A Type" onkeyup="fx1('myInput2',1)" />
                        </div>
                    </th>
                    <th>
                        <div class="inner-addon left-addon">
                            <i class="glyphicon glyphicon-search"></i>
                            <input type="text" id="myInput3" class="form-control" placeholder="D Type" onkeyup="fx1('myInput3',2)" />
                        </div>
                    </th>
                    <th>
                        <div class="inner-addon left-addon">
                            <i class="glyphicon glyphicon-search"></i>
                            <input type="text" id="myInput4" class="form-control" placeholder="Code" onkeyup="fx1('myInput4',3)" />
                        </div>
                    </th>
                    <th>
                        <div class="inner-addon left-addon">
                            <i class="glyphicon glyphicon-search"></i>
                            <input type="text" id="myInput5" class="form-control" placeholder="Ref No." onkeyup="fx1('myInput5',4)" />
                        </div>
                    </th>
                    <th colspan="2">Created Date</th>
                </thead>
                <tbody>
                    <%for(var i=0;i<data.length;i++){%>
                        <tr>
                            <td id="_state">
                                <%=data[i]._state%>
                            </td>
                            <td id="_atype">
                                <%=data[i].a_type%>
                            </td>
                            <td id="_dtype">
                                <%=data[i].d_type%>
                            </td>
                            <td id="_code">
                                <%=data[i].code%>
                            </td>
                            <td id="_ref">
                                <%=data[i].ref_no%>
                            </td>
                            <td>
                                <%=data[i].created.getDate()+"/"+data[i].created.getMonth()+"/"+data[i].created.getFullYear()%>
                            </td>
                            <td>
                                <% var str = "/delete/"+data[i]._id %>
                                    <a href=<%=str%>>Delete</a>
                            </td>
                        </tr>
                        <%}%>
                </tbody>
            </table>
            <!-- </div> -->
        </div>
    </div>


    <script>
        openCity('create', 'search', 1);

        function openCity(id1, id2, i) {
            console.log(i);
            document.getElementById(id1).style.display = "block";
            document.getElementById(id2).style.display = "none";
            if (i == 1) {
                document.getElementById("cr1").style.backgroundColor = "#c7c7bb";
                document.getElementById("cr2").style.backgroundColor = "#f1f1f1";
            } else {
                document.getElementById("cr2").style.backgroundColor = "#c7c7bb";
                document.getElementById("cr1").style.backgroundColor = "#f1f1f1";
            }
        }

        function disp() {
            document.getElementsByClassName('info')[0].style.display = "block";
            document.getElementById("popup1").style.border = "2px solid black";
        }

        function nodisp() {
            document.getElementsByClassName('info')[0].style.display = "none";
            document.getElementById("popup1").style.border = "2px solid white";
        }
        let str1, str2, str3;

        function gen3() {
            str1 = document.getElementById("state").value.slice(0, 2).toUpperCase();
            str2 = document.getElementById("atype").value;
            str3 = document.getElementById("dtype").value;
            console.log(str1 + str2 + str3 + document.getElementById("incode").innerHTML);
            let str4 = document.getElementById("generetedCode").innerText;
            str4 = "Code has been created: " + str1 + str2 + str3 + str4.trim();
            document.getElementById("generetedCode").innerHTML = str4;
            document.getElementById("generetedCode").style.display = "block";

        }

        function fx1(id1, id2) {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById(id1);
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[id2];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>

</body>

</html>